<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Convert technical PDFs to readable, TTS-friendly documents using AI">
    <title>Convert to Readable Spokable PDF</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/dark-mode.css">

    <!-- PDF.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

    <!-- jsPDF Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <span class="logo">üìÑ‚Üíüîä</span>
                <span class="brand-text">Readable Spokable PDF</span>
            </div>
            <div class="nav-links">
                <a href="index.html" class="nav-link active">Home</a>
                <a href="pages/about.html" class="nav-link">About</a>
                <a href="pages/faq.html" class="nav-link">FAQ</a>
                <a href="pages/diagnostics.html" class="nav-link">Diagnostics</a>
                <button id="settingsBtn" class="icon-btn" aria-label="Settings">‚öôÔ∏è</button>
                <button id="darkModeToggle" class="icon-btn" aria-label="Toggle dark mode">üåô</button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container">
        <!-- Welcome Banner (shown on first visit) -->
        <div id="welcomeBanner" class="welcome-banner hidden">
            <div class="welcome-content">
                <h2>üëã Welcome to Readable Spokable PDF!</h2>
                <p>Transform technical PDFs into natural, spoken-friendly documents perfect for text-to-speech apps.</p>
                <div class="welcome-steps">
                    <div class="step">
                        <span class="step-number">1</span>
                        <p>Get your free API key from <a href="https://aistudio.google.com/app/apikey" target="_blank"
                                rel="noopener">Google AI Studio</a></p>
                    </div>
                    <div class="step">
                        <span class="step-number">2</span>
                        <p>Click Settings ‚öôÔ∏è and paste your API key</p>
                    </div>
                    <div class="step">
                        <span class="step-number">3</span>
                        <p>Upload a PDF and click PROCESS</p>
                    </div>
                </div>
                <button id="closeWelcome" class="btn btn-primary">Got it!</button>
            </div>
        </div>

        <!-- File Upload Section -->
        <section class="upload-section">
            <div id="dropZone" class="drop-zone">
                <div class="drop-zone-content">
                    <span class="upload-icon">üìÅ</span>
                    <h3>Drop PDF here or click to select</h3>
                    <p>Supports PDFs with selectable text (no OCR required)</p>
                    <input type="file" id="fileInput" accept=".pdf" hidden>
                    <button id="selectFileBtn" class="btn btn-primary">Select PDF File</button>
                </div>
            </div>

            <!-- File Info (shown after selection) -->
            <div id="fileInfo" class="file-info hidden">
                <h3>üìÑ File Information</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">Filename:</span>
                        <span id="fileName" class="info-value"></span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Pages:</span>
                        <span id="filePages" class="info-value"></span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Size:</span>
                        <span id="fileSize" class="info-value"></span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Text Length:</span>
                        <span id="textLength" class="info-value"></span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Detected Language:</span>
                        <span id="detectedLang" class="info-value"></span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Estimated Batches:</span>
                        <span id="estimatedBatches" class="info-value"></span>
                    </div>
                </div>
                <div class="action-buttons">
                    <button id="processBtn" class="btn btn-success btn-lg">‚ñ∂Ô∏è PROCESS</button>
                    <button id="cancelFileBtn" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </section>

        <!-- Progress Section (shown during processing) -->
        <section id="progressSection" class="progress-section hidden">
            <h3>‚öôÔ∏è Processing</h3>

            <div class="progress-bar-container">
                <div id="progressBar" class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0"
                    aria-valuemax="100">
                    <div class="progress-fill"></div>
                </div>
                <span id="progressPercent" class="progress-percent">0%</span>
            </div>

            <div class="progress-details">
                <div class="progress-item">
                    <span class="progress-label">Stage:</span>
                    <span id="currentStage" class="progress-value">Initializing...</span>
                </div>
                <div class="progress-item">
                    <span class="progress-label">Batch:</span>
                    <span id="batchProgress" class="progress-value">0 / 0</span>
                </div>
                <div class="progress-item">
                    <span class="progress-label">ETA:</span>
                    <span id="eta" class="progress-value">Calculating...</span>
                </div>
                <div class="progress-item">
                    <span class="progress-label">Speed:</span>
                    <span id="speed" class="progress-value">-</span>
                </div>
                div>

                <!-- Batch Status Table -->
                <div class="batch-status">
                    <h4>Batch Status</h4>
                    <div id="batchTable" class="batch-table"></div>
                </div>

                <div class="progress-actions">
                    <button id="pauseBtn" class="btn btn-warning">‚è∏Ô∏è Pause</button>
                    <button id="cancelBtn" class="btn btn-danger">‚ùå Cancel</button>
                    <button id="downloadPartialBtn" class="btn btn-secondary">üíæ Download Partial</button>
                </div>
        </section>

        <!-- Results Section -->
        <section id="resultsSection" class="results-section hidden">
            <h3>‚úÖ Processing Complete!</h3>
            <div class="results-info">
                <p>Your readable, spokable PDF is ready for download.</p>
                <div class="results-stats">
                    <div class="stat">
                        <span class="stat-label">Original Text:</span>
                        <span id="originalLength" class="stat-value"></span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Transformed Text:</span>
                        <span id="transformedLength" class="stat-value"></span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Processing Time:</span>
                        <span id="processingTime" class="stat-value"></span>
                    </div>
                </div>
            </div>
            <div class="results-actions">
                <button id="downloadPdfBtn" class="btn btn-success btn-lg">üì• Download PDF</button>
                <button id="downloadTextBtn" class="btn btn-secondary">üìÑ Download as Text</button>
                <button id="previewBtn" class="btn btn-secondary">üëÅÔ∏è Preview</button>
                <button id="newFileBtn" class="btn btn-primary">üîÑ Process Another File</button>
            </div>
        </section>

        <!-- Stored Files Section -->
        <section class="stored-files-section">
            <h3>üíæ Stored Files</h3>
            <div id="storedFilesList" class="stored-files-list">
                <p class="empty-state">No stored files yet. Upload and process a PDF to get started.</p>
            </div>
        </section>
    </main>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚öôÔ∏è Settings</h2>
                <button class="modal-close" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-tabs">
                    <button class="tab-btn active" data-tab="api">API</button>
                    <button class="tab-btn" data-tab="processing">Processing</button>
                    <button class="tab-btn" data-tab="prompts">Prompts</button>
                    <button class="tab-btn" data-tab="output">Output</button>
                    <button class="tab-btn" data-tab="advanced">Advanced</button>
                </div>

                <!-- API Tab -->
                <div id="apiTab" class="tab-content active">
                    <div class="form-group">
                        <label for="apiKey">Google AI Studio API Key *</label>
                        <input type="password" id="apiKey" placeholder="Paste your API key here">
                        <small>Get your key from <a href="https://aistudio.google.com/app/apikey" target="_blank"
                                rel="noopener">Google AI Studio</a></small>
                    </div>
                    <div class="form-group">
                        <label for="backupApiKey">Backup API Key (optional)</label>
                        <input type="password" id="backupApiKey" placeholder="Optional backup key for failover">
                    </div>
                    <div class="form-group">
                        <label for="apiTimeout">API Timeout (seconds)</label>
                        <input type="number" id="apiTimeout" value="60" min="10" max="300">
                    </div>
                    <button id="clearApiKey" class="btn btn-danger btn-sm">Clear API Keys</button>
                </div>

                <!-- Processing Tab -->
                <div id="processingTab" class="tab-content">
                    <div class="form-group">
                        <label for="batchSize">Batch Size (tokens)</label>
                        <input type="number" id="batchSize" value="10000" min="1000" max="50000">
                    </div>
                    <div class="form-group">
                        <label for="overlapSize">Overlap Size (tokens)</label>
                        <input type="number" id="overlapSize" value="200" min="0" max="1000">
                    </div>
                    <div class="form-group">
                        <label for="maxRetries">Max Retries</label>
                        <input type="number" id="maxRetries" value="3" min="0" max="10">
                    </div>
                    <div class="form-group">
                        <label for="retryDelay">Retry Delay (ms)</label>
                        <input type="number" id="retryDelay" value="2000" min="0" max="10000">
                    </div>
                    <div class="form-group">
                        <label for="rateLimitDelay">Rate Limit Delay (ms)</label>
                        <input type="number" id="rateLimitDelay" value="1000" min="0" max="5000">
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="turboMode">
                            Enable Turbo Mode (Parallel Processing)
                        </label>
                    </div>
                    <div class="form-group">
                        <label for="parallelChunks">Parallel Chunks</label>
                        <input type="number" id="parallelChunks" value="3" min="1" max="10">
                    </div>
                </div>

                <!-- Prompts Tab -->
                <div id="promptsTab" class="tab-content">
                    <div class="form-group">
                        <label for="systemPrompt">System Prompt</label>
                        <textarea id="systemPrompt"
                            rows="3">You are an expert at converting technical documentation into natural, spoken language optimized for text-to-speech systems.</textarea>
                    </div>
                    <div class="form-group">
                        <label for="transformPrompt">Text Transformation Prompt</label>
                        <textarea id="transformPrompt"
                            rows="6">Convert the following text into a natural, spoken format that is easy to listen to. Maintain accuracy while making it conversational. Expand acronyms on first use. Convert formulas and special symbols into spoken words. Convert tables into narrative sentences. Describe figures and images clearly. Replace code blocks with descriptive explanations of what the code does (do not read code line-by-line). Preserve the logical order and headings. Add natural transitions between sections. Remove inline citations and footnotes. Make the output TTS-friendly with good rhythm (commas and pauses).</textarea>
                    </div>
                    <button id="resetPrompts" class="btn btn-secondary btn-sm">Reset to Defaults</button>
                </div>

                <!-- Output Tab -->
                <div id="outputTab" class="tab-content">
                    <div class="form-group">
                        <label for="fontSize">Font Size (pt)</label>
                        <input type="number" id="fontSize" value="12" min="8" max="24">
                    </div>
                    <div class="form-group">
                        <label for="lineHeight">Line Height</label>
                        <input type="number" id="lineHeight" value="1.5" min="1" max="3" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="pageMargin">Page Margin (mm)</label>
                        <input type="number" id="pageMargin" value="20" min="5" max="50">
                    </div>
                    <div class="form-group">
                        <label for="fontFamily">Font Family</label>
                        <select id="fontFamily">
                            <option value="Times New Roman">Times New Roman</option>
                            <option value="Arial">Arial</option>
                            <option value="Helvetica">Helvetica</option>
                            <option value="Georgia">Georgia</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="pageSize">Page Size</label>
                        <select id="pageSize">
                            <option value="Letter">Letter</option>
                            <option value="A4">A4</option>
                            <option value="Legal">Legal</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="addPageNumbers" checked>
                            Add Page Numbers
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="generateToc" checked>
                            Generate Table of Contents
                        </label>
                    </div>
                </div>

                <!-- Advanced Tab -->
                <div id="advancedTab" class="tab-content">
                    <div class="form-group">
                        <label for="modelPriority">Model Priority (one per line)</label>
                        <textarea id="modelPriority" rows="8">gemini-2.0-flash-exp
gemini-2.0-flash-thinking-exp-1219
gemini-exp-1206
gemini-2.5-flash
gemini-2.5-pro
gemini-2.0-flash</textarea>
                        <small>Models will be tried in order. Use Diagnostics to see available models.</small>
                    </div>
                    <div class="form-group">
                        <label for="temperature">Temperature</label>
                        <input type="number" id="temperature" value="1" min="0" max="2" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="topP">Top P</label>
                        <input type="number" id="topP" value="0.95" min="0" max="1" step="0.05">
                    </div>
                    <div class="form-group">
                        <label for="topK">Top K</label>
                        <input type="number" id="topK" value="40" min="1" max="100">
                    </div>
                    <div class="form-group">
                        <label for="maxOutputTokens">Max Output Tokens</label>
                        <input type="number" id="maxOutputTokens" value="4000" min="100" max="8000">
                    </div>
                    <button id="resetSettings" class="btn btn-danger btn-sm">Reset All Settings</button>
                    <button id="eraseAllData" class="btn btn-danger btn-sm">Erase All Data</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Scripts -->
    <!-- Test script to verify button works -->
    <script>
        console.log('=== TESTING SCRIPT LOADED ===');
        window.addEventListener('DOMContentLoaded', () => {
            console.log('DOM loaded');
            const btn = document.getElementById('selectFileBtn');
            const input = document.getElementById('fileInput');
            console.log('Button found:', btn);
            console.log('Input found:', input);

            if (btn && input) {
                console.log('Adding fallback click handler');
                btn.addEventListener('click', function (e) {
                    console.log('FALLBACK HANDLER: Button clicked!');
                    e.preventDefault();
                    e.stopPropagation();
                    input.click();
                    console.log('Input.click() called');
                });
            } else {
                console.error('Button or input not found!');
            }
        });
    </script>
    <script type="module" src="js/app.js"></script>
</body>

</html>